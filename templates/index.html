<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Search Performance Tracker</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9B4WW61DS4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9B4WW61DS4');
    </script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîç</text></svg>">
</head>
<body>
    <header class="hero">
        <h1><i class="fas fa-search icon-large" aria-hidden="true"></i>LLM Search Performance Tracker</h1>
        <p>Discover your brand's visibility in AI-powered search results</p>
        <p class="user-count"><i class="fas fa-users icon-small" aria-hidden="true"></i><span id="user-count">{{ user_count }}</span> users have improved their LLM visibility</p>
        <form id="analyzeForm" class="hero-form">
            <label for="domainInput" class="sr-only">Enter your website domain</label>
            <input type="text" name="domain" id="domainInput" placeholder="Enter your website domain (e.g., example.com)" required aria-required="true">
            <button type="submit" class="cta-button"><i class="fas fa-rocket icon-small" aria-hidden="true"></i>Analyze Now</button>
        </form>
        <p class="cta-text"><span id="searches-left">{{ searches_left }}</span> free searches left</p>
        <div class="spinner" id="spinner" aria-hidden="true"></div>
        <div id="progress-log" aria-live="polite"></div>
    </header>
    
    <div id="error-message" class="error-message" style="display: none;"></div>
    
    <main id="results-container" style="display: none;">
        <!-- Results will be dynamically inserted here -->
    </main>

    <section id="landing-content">
        <section class="intro">
            <h2><i class="fas fa-eye icon-large"></i>Stay Seen in the New Search World</h2>
            <p>Search is changing from Google to new smart helpers called LLMs. It is important to know where your brand shows up in these new searches. Our tool helps you see where you are in these searches, so you can stay easy to find and ahead of others.</p>
            <a href="#" class="cta-button-secondary" onclick="document.getElementById('domainInput').focus(); return false;">Try it Now</a>
        </section>

        <section class="how-it-works">
            <h2><i class="fas fa-cogs icon-large"></i>How It Works</h2>
            <ol>
                <li><i class="fas fa-globe icon-small"></i><strong>Enter Your Website:</strong> Type in your website domain (e.g., example.com).</li>
                <li><i class="fas fa-chart-bar icon-small"></i><strong>Analyze Content:</strong> We look at your website and find things people might search for about you.</li>
                <li><i class="fas fa-robot icon-small"></i><strong>Simulate Search Results:</strong> Our AI shows what the LLM helper will say when people search for those things.</li>
                <li><i class="fas fa-check-circle icon-small"></i><strong>Review Visibility:</strong> See where you show up and compare to others.</li>
            </ol>
        </section>

        <section class="sample-result">
            <h3><i class="fas fa-chart-line icon-large"></i>Sample Result for ebay.com</h3>
            <p>This table shows an example of what our tool provides. It demonstrates how your website might appear in AI-powered search results for different queries, and how it compares to competitors.</p>
            <table class="sample-table">
                <thead>
                    <tr>
                        <th>
                            Prompt
                            <span class="tooltip">
                                <i class="fas fa-info-circle info-icon"></i>
                                <span class="tooltiptext">The search query or question that a user might ask an AI assistant.</span>
                            </span>
                        </th>
                        <th>
                            Top Competitors
                            <span class="tooltip">
                                <i class="fas fa-info-circle info-icon"></i>
                                <span class="tooltiptext">Other websites mentioned in the AI's response to the prompt.</span>
                            </span>
                        </th>
                        <th>
                            Visible in LLM?
                            <span class="tooltip">
                                <i class="fas fa-info-circle info-icon"></i>
                                <span class="tooltiptext">Whether your website appears in the AI's response, and if so, its ranking among competitors.</span>
                            </span>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Best online shopping platforms</td>
                        <td>amazon.com, ebay.com</td>
                        <td class="sample-visible">Yes (Rank: 2)</td>
                    </tr>
                    <tr>
                        <td>Reliable e-commerce websites</td>
                        <td>amazon.com, walmart.com</td>
                        <td class="sample-not-visible">No</td>
                    </tr>
                    <tr>
                        <td>Where to buy used electronics online</td>
                        <td>ebay.com, bestbuy.com</td>
                        <td class="sample-visible">Yes (Rank: 1)</td>
                    </tr>
                </tbody>
            </table>
            <p>Interpretation: In this example, ebay.com appears in AI responses for 2 out of 3 queries. It ranks 2nd for "Best online shopping platforms" and 1st for "Where to buy used electronics online". However, it doesn't appear in results for "Reliable e-commerce websites", which might be an area for improvement.</p>
        </section>
    </section>

    <footer style="text-align: center; padding: 20px 0;">
        <p>&copy; 2024 LLM Search Performance Tracker. All rights reserved.</p>
        <nav>
            <a href="{{ url_for('privacy_policy') }}">Privacy Policy</a> |
            <a href="{{ url_for('terms_of_service') }}">Terms of Service</a> |
            <a href="mailto:{{ contact_email }}">Contact Us</a>
        </nav>
    </footer>

    <a href="#" id="back-to-top" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up" aria-hidden="true"></i>
    </a>

    <script>
        function extractDomain(url) {
            url = url.replace(/^(?:https?:\/\/)?(?:www\.)?/i, "");
            return url.split('/')[0];
        }

        function updateProgress(message) {
            const progressLog = document.getElementById('progress-log');
            progressLog.innerHTML += `<p>${message}</p>`;
        }

        document.getElementById('analyzeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var domainInput = document.getElementById('domainInput');
            domainInput.value = extractDomain(domainInput.value);
            document.getElementById('spinner').style.display = 'block';
            document.getElementById('progress-log').innerHTML = '';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('results-container').style.display = 'none';
            this.querySelector('button').disabled = true;

            updateProgress('Fetching website content...');

            fetch('/analyze', {
                method: 'POST',
                body: new FormData(this)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('spinner').style.display = 'none';
                this.querySelector('button').disabled = false;

                if (data.error) {
                    document.getElementById('error-message').textContent = data.error;
                    document.getElementById('error-message').style.display = 'block';
                } else {
                    displayResults(data);
                }

                document.getElementById('searches-left').textContent = data.searches_left;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('spinner').style.display = 'none';
                document.getElementById('error-message').textContent = 'An error occurred. Please try again.';
                document.getElementById('error-message').style.display = 'block';
                this.querySelector('button').disabled = false;
            });
        });

        function displayResults(data) {
            const resultsContainer = document.getElementById('results-container');
            const landingContent = document.getElementById('landing-content');
            const progressLog = document.getElementById('progress-log');
            
            // Clear the progress log
            progressLog.innerHTML = '';
            
            resultsContainer.innerHTML = `
                <h1>Results for ${data.domain}</h1>
                <h2>Website Information</h2>
                <p><strong>Title:</strong> ${data.info.title}</p>
                <p><strong>Description:</strong> ${data.info.description}</p>
                
                <h2>Relevant Searches</h2>
                <ol>
                    ${data.prompts.map(prompt => `<li>${prompt.replace(/^\d+\.\s*/, '')}</li>`).join('')}
                </ol>
                
                <h2>Visibility and Competitors</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Prompt</th>
                                <th>Answer</th>
                                <th>Top Competitors</th>
                                <th>Visible in LLM?</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.table.map((row, index) => `
                                <tr>
                                    <td class="expandable">
                                        <div class="content">${row.prompt}</div>
                                        <button class="expand-btn" aria-label="Expand">+</button>
                                    </td>
                                    <td class="expandable">
                                        <div class="content">${row.answer}</div>
                                        <button class="expand-btn" aria-label="Expand">+</button>
                                    </td>
                                    <td>
                                        ${row.competitors !== 'None mentioned' ? 
                                            `<ol>${row.competitors.split(', ').map(comp => `<li>${comp}</li>`).join('')}</ol>` :
                                            row.competitors
                                        }
                                    </td>
                                    <td class="visibility-status ${row.visible.includes('Yes') ? 'visible' : 'not-visible'}">
                                        ${formatVisibility(row.visible)}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            resultsContainer.style.display = 'block';
            landingContent.style.display = 'none';
            
            // Re-attach event listeners for expandable content
            document.querySelectorAll('.expand-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const content = this.previousElementSibling;
                    content.classList.toggle('expanded');
                    this.textContent = content.classList.contains('expanded') ? '-' : '+';
                });
            });

            // Add CTA based on searches left
            const ctaContainer = document.createElement('div');
            ctaContainer.className = 'cta-container';
            if (data.searches_left > 0) {
                ctaContainer.innerHTML = `
                    <p class="cta-text">You have ${data.searches_left} free searches left. Want to analyze more domains?</p>
                    <a href="#" class="cta-button" onclick="document.getElementById('domainInput').focus(); return false;">Analyze Another Domain</a>
                `;
            } else {
                ctaContainer.innerHTML = `
                    <p class="cta-text">You've used all your free searches. Want to analyze more domains and get deeper insights?</p>
                    <a href="https://mv71z3xpmnl.typeform.com/to/bmN8bM2y" target="_blank" class="cta-button waiting-list-button">Join Waiting List for Premium Access</a>
                `;
            }
            resultsContainer.appendChild(ctaContainer);
        }

        function formatVisibility(visible) {
            if (visible.includes('Yes')) {
                const rank = visible.match(/\d+/)[0];
                let rankText = '';
                switch (rank) {
                    case '1':
                        rankText = 'first! ü•áüéâ';
                        break;
                    case '2':
                        rankText = 'second! ü•àüéâ';
                        break;
                    case '3':
                        rankText = 'third! ü•âüéâ';
                        break;
                    default:
                        rankText = `${rank}th! üéâ`;
                }
                return `<span style="color: green;">‚úì Yes</span><br>Congrats, you're ${rankText}`;
            } else {
                return '<span style="color: red;">‚úó No</span>';
            }
        }

        // Back to top button functionality
        var backToTopButton = document.getElementById("back-to-top");
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                backToTopButton.style.display = "block";
            } else {
                backToTopButton.style.display = "none";
            }
        }

        backToTopButton.onclick = function() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }
    </script>
</body>
</html>